---
layout: post
title: "[ComputerScience] 가상메모리와 페이징기법!"
tags: 
categories:
  - ComputerScience
---

## Intro
가상메모리와 페이징기법에 대해 알아보자

<br/>

## 1. 가상메모리

 - 가상메모리는 메모리를 관리하는 방법의 하나로, 각 프로그램에 실제 메모리 주소가 아닌 가상의 메모리 주소를 주는 방식을 말한다.
 - 이러한 방식은 멀티태스킹 운영 체제에서 흔히 사용되며, 실제 주기억장치(RAM)보다 큰 메모리 영역을 제공하는 방법으로 사용된다.
 - 초창기 컴퓨터에는 가장 큰 실행 애플리케이션의 주소 공간보다 큰 RAM의 용량을 보유해야 했다. 그렇지 않으면 메모리 부족으로 해당 애플리케이션을 실행할 수 없었다. <br/> 가상메모리 기법은 애플리케이션을 실행하는 데 얼마나 많은 메모리가 필요한지에 집중하지 않고, 대신 애플리케이션을 실행하는 데 최소한 얼마만큼의 메모리가 필요한지에 집중하여 문제를 해결하고자 하였다.
 
<br/>

### 1.1 구조

 - 가상메모리 구조는 크게 Code, Data, Heap, Stack 영역으로 구분 된다.
 
![image](https://user-images.githubusercontent.com/51254582/166413272-04105cdf-5873-4409-8abd-5fc34aafea0a.png)

||`구조`|`설명`|
|---|---|---|
|1|`Code 영역`|사용자가 작성한 프로그램 함수들의 코드가 CPU에서 수행할 수 있는 기계어 명령 형태로 변환되어 저장되는 공간 <br/> 컴파일(compile) 타임에 결정되며 중간에 코드를 바꿀 수 없게 Read-Only 로 되어있다.|
|2|`Data 영역`|Data 영역은 전역변수 또는 정적변수가 저장되는 공간으로 Data영역과 BSS영역으로 나뉜다. <br/> Data 영역 : 초기값이 있는 데이터 저장 공간 <br/> BSS영역 : 초기값이 없는 데이터 저장 공간|
|3|`Heap 영역`|프로그래머가 필요할 때마다 사용하는 메모리 영역으로 런타임에 결정된다.|
|4|`Stack 영역`|호출된 함수의 수행을 마치고 복귀할 주소 및 데이터(지역변수, 매개변수, 리턴값 등)를 임시로 저장하는 공간 <br/> 메커니즘은 자료구조(stack)에서 배운 LIFO(Last In First Out) 방법을 따른다. <br/> 컴파일 시 stack 영역의 크기가 결정되기 때문에 무한정 할당 할 수 없다. 따라서 재귀함수가 반복해서 호출되거나 함수가 지역변수를 메모리를 초과할 정도로 너무 많이 가지고 있다면 Stack Overflow가 발생한다.|

<br/>

## 2. 페이징기법
 
 - 페이징 기법은 컴퓨터가 메인 메모리에서 사용하기 위해 데이터를 저장하고 검색하는 메모리 관리 기법이다.
 - 페이징 기법을 통해 컴퓨터의 물리적 메모리는 연속적으로 할당되어 존재할 필요가 없으며, 반대로 연속적으로 존재하지 않는 물리적 메모리라도 페이징 기법을 통해 연속적으로 존재하는 것처럼 이용될 수 있다.
 - 페이징 방식에서는 가상 메모리 상의 주소 공간을 일정한 크기로 분할한다. 주소공간은 페이지 단위로 나뉘어져있으며 실제 기억공간은 페이지 크기와 같은 프레임으로 나누어 사용한다. <br/> Frame : 물리 메모리를 일정된 한 크기로 나눈 블록 <br/> Page : 가상 메모리를 일정된 한 크기로 나눈 블록
 - 페이징 기법에서 페이지는 페이지테이블(Page Table) 이라는 자료구조 형태로 관리된다. Page Table 은 프로세스의 페이지 정보를 저장하고 있으며, 하나의 프로세스는 하나의 페이지 테이블을 가진다.
 
![image](https://user-images.githubusercontent.com/51254582/166415163-c7a95022-70ac-4ca5-ba08-35739efc13f1.png)

||`용어`|`설명`|
|---|---|---|
|1|`Page In/Out`|Page Out은 기존에 물리메모리에서 사용중인 프레임의 내용을 스왑 스페이스에 저장하고 그 프레임을 현재 필요로 하는 다른 프로세스에게 할당하는 것을 말한다. <br/> Page In은 반대로 스왑 스페이스에 머물러있는 내용을 다시 메모리로 불러들여 프레임을 제공하는 것을 말한다.|
|2|`Page Fault`|프로세스에서 접근하려고 하는 프레임이 물리메모리에 없음을 뜻한다.|

<br/>

### 2.1 상태

 - 가상메모리에서 페이지의 상태는 Free, Reserve, Commit 세 가지로 나뉜다.
 - 메모리는 지역성의 원리에 따라 연속된 메모리공간을 사용할수록 캐시히트율이 높아진다고 하였다. 그렇다면 연속된 메모리공간을 사용하기 위해 가상메모리 영역을 모두 Commit으로 확보해버리면 어떻게 될까?
 - 해당 가상메모리 페이지는 모두 물리메모리 프레임에 매핑 되어 버리므로 물리메모리 공간이 심하게 낭비된다. 따라서 Reserve를 통해 가상메모리 페이지의 연속된 메모리 공간은 예약하고 실제 물리메모리에는 매핑을 시키지 않아 메모리 사용의 효율성을 높이는 방식을 사용한다.

||`상태`|`의미`|
|---|---|---|
|1|`Free`|할당되지 않음|
|2|`Reserve`|예약완료 (최소 단위 : 64KB)|
|3|`Commit`|할당완료 (최소 단위 : 4KB)|
